<div class="auth-container">
  <mat-card class="auth-card">
    <mat-card-header class="auth-header p-4 pb-4">
      <div class="auth-logo">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect width="48" height="48" rx="12" fill="url(#grad1)" />
          <path d="M24 12L32 18V36H16V18L24 12Z" fill="white" />
          <path d="M24 20L28 23V32H20V23L24 20Z" fill="#e7f1ff" />
          <defs>
            <linearGradient id="grad1" x1="0" y1="0" x2="48" y2="48">
              <stop offset="0%" style="stop-color: #007bff; stop-opacity: 1" />
              <stop offset="100%" style="stop-color: #0056b3; stop-opacity: 1" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <mat-card-title class="auth-title">Ecommerce</mat-card-title>
      <mat-card-subtitle class="auth-subtitle m-0">Your trusted shopping destination</mat-card-subtitle>
    </mat-card-header>

    <mat-tab-group
      [(selectedIndex)]="mode"
      (selectedIndexChange)="toggleMode($event)"
      class="auth-tabs"
      animationDuration="300"
    >
      <!-- Login Tab -->
      <mat-tab label="Sign In" class="auth-tab">
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">login</mat-icon>
          <span class="tab-label">Sign In</span>
        </ng-template>

        <mat-card-content class="form-content">
          <form [formGroup]="loginForm" (ngSubmit)="submitLogin()" class="auth-form">
            <!-- Username Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Username or Email</mat-label>
              <input
                matInput
                formControlName="username"
                type="text"
                placeholder="Enter your username"
                autocomplete="username"
              />
              <mat-icon matPrefix>person</mat-icon>
              @if (loginForm.get('username')?.hasError('required') && loginForm.get('username')?.touched) {
              <mat-error>Username is required</mat-error>
              } @if (loginForm.get('username')?.hasError('minlength') && loginForm.get('username')?.touched) {
              <mat-error>Username must be at least 3 characters</mat-error>
              }
            </mat-form-field>

            <!-- Password Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password</mat-label>
              <input
                matInput
                formControlName="password"
                [type]="hideLoginPassword ? 'password' : 'text'"
                placeholder="Enter your password"
                autocomplete="current-password"
              />
              <mat-icon matPrefix>lock</mat-icon>
              <button
                mat-icon-button
                matSuffix
                (click)="toggleLoginPasswordVisibility()"
                type="button"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hideLoginPassword"
              >
                <mat-icon>{{ hideLoginPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (loginForm.get('password')?.hasError('required') && loginForm.get('password')?.touched) {
              <mat-error>Password is required</mat-error>
              } @if (loginForm.get('password')?.hasError('minlength') && loginForm.get('password')?.touched) {
              <mat-error>Password must be at least 6 characters</mat-error>
              }
            </mat-form-field>

            <!-- Submit Button -->
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="loading || loginForm.invalid"
              class="submit-button"
            >
              @if (loading) {
                <mat-spinner diameter="24" class="spinner"></mat-spinner>
                <span class="button-text">Signing in...</span>
              } @else {
                <ng-container>
                  <mat-icon>login</mat-icon>
                  <span class="button-text">Sign In</span>
                </ng-container>
              }
            </button>

            <!-- Footer Link -->
            <p class="form-footer">
              Don't have an account?
              <a href="javascript:void(0)" (click)="toggleMode(1)" class="link">Create one</a>
            </p>
          </form>
        </mat-card-content>
      </mat-tab>

      <!-- Register Tab -->
      <mat-tab label="Sign Up" class="auth-tab">
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">app_registration</mat-icon>
          <span class="tab-label">Sign Up</span>
        </ng-template>

        <mat-card-content class="form-content">
          <form [formGroup]="registerForm" (ngSubmit)="submitRegister()" class="auth-form">
            <!-- Username Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Username</mat-label>
              <input
                matInput
                formControlName="username"
                type="text"
                placeholder="Choose a username"
                autocomplete="username"
              />
              <mat-icon matPrefix>person</mat-icon>
              @if (registerForm.get('username')?.hasError('required') && registerForm.get('username')?.touched) {
              <mat-error>Username is required</mat-error>
              } @if (registerForm.get('username')?.hasError('minlength') && registerForm.get('username')?.touched) {
              <mat-error>Username must be at least 3 characters</mat-error>
              }
            </mat-form-field>

            <!-- Email Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email Address</mat-label>
              <input
                matInput
                formControlName="email"
                type="email"
                placeholder="your@email.com"
                autocomplete="email"
              />
              <mat-icon matPrefix>mail</mat-icon>
              @if (registerForm.get('email')?.hasError('required') && registerForm.get('email')?.touched) {
              <mat-error>Email is required</mat-error>
              } @if (registerForm.get('email')?.hasError('email') && registerForm.get('email')?.touched) {
              <mat-error>Please enter a valid email address</mat-error>
              }
            </mat-form-field>

            <!-- Password Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password</mat-label>
              <input
                matInput
                formControlName="password"
                [type]="hideRegisterPassword ? 'password' : 'text'"
                placeholder="Create a strong password"
                autocomplete="new-password"
              />
              <mat-icon matPrefix>lock</mat-icon>
              <button
                mat-icon-button
                matSuffix
                (click)="toggleRegisterPasswordVisibility()"
                type="button"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hideRegisterPassword"
              >
                <mat-icon>{{ hideRegisterPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (registerForm.get('password')?.hasError('required') && registerForm.get('password')?.touched) {
              <mat-error>Password is required</mat-error>
              } @if (registerForm.get('password')?.hasError('minlength') && registerForm.get('password')?.touched) {
              <mat-error>Password must be at least 6 characters</mat-error>
              }
            </mat-form-field>

            <!-- Confirm Password Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirm Password</mat-label>
              <input
                matInput
                formControlName="confirmPassword"
                [type]="hideConfirmPassword ? 'password' : 'text'"
                placeholder="Re-enter your password"
                autocomplete="new-password"
              />
              <mat-icon matPrefix>lock</mat-icon>
              <button
                mat-icon-button
                matSuffix
                (click)="toggleConfirmPasswordVisibility()"
                type="button"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hideConfirmPassword"
              >
                <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              @if (registerForm.get('confirmPassword')?.hasError('required') && registerForm.get('confirmPassword')?.touched) {
              <mat-error>Please confirm your password</mat-error>
              }
            </mat-form-field>

            <!-- Role Selection -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Role</mat-label>
              <mat-select formControlName="role">
                <mat-option value="USER">User</mat-option>
                <mat-option value="VENDOR">Vendor</mat-option>
                <mat-option value="ADMIN">Admin</mat-option>
              </mat-select>
              <mat-icon matPrefix>security</mat-icon>
            </mat-form-field>

            <!-- Submit Button -->
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="loading || registerForm.invalid"
              class="submit-button"
            >
              @if (loading) {
                <mat-spinner diameter="24" class="spinner"></mat-spinner>
                <span class="button-text">Creating Account...</span>
              } @else {
                <ng-container>
                  <mat-icon>app_registration</mat-icon>
                  <span class="button-text">Create Account</span>
                </ng-container>
              }
            </button>

            <!-- Footer Link -->
            <p class="form-footer">
              Already have an account?
              <a href="javascript:void(0)" (click)="toggleMode(0)" class="link">Sign in</a>
            </p>
          </form>
        </mat-card-content>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</div>
